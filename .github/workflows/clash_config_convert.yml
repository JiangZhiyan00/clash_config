name: è½¬æ¢Clashé…ç½®å¹¶æäº¤

on:
  push:
    paths:
      - "config.yml"
  workflow_dispatch:

jobs:
  convert-and-commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v6
        with:
          node-version: "lts/*"

      - name: å®‰è£…ä¾èµ–
        run: npm ci
        working-directory: ./clash/converter

      - name: åˆ›å»ºè¾“å‡ºç›®å½•
        run: mkdir -p dist

      - name: è½¬æ¢é…ç½®æ–‡ä»¶
        run: node clash/converter/convert.js config.yml dist/config.yml

      - name: æäº¤è½¬æ¢åçš„æ–‡ä»¶
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add dist/config.yml
          git diff --quiet && git diff --staged --quiet || git commit -m "ğŸš€ è‡ªåŠ¨æ›´æ–°è½¬æ¢åçš„é…ç½®æ–‡ä»¶"
          git push
